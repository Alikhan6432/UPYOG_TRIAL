{"version":3,"sources":["../../src/utils/externalAPIMapping.js"],"names":["escapeRegex","string","replace","externalAPIMapping","key","req","dataconfig","variableTovalueMap","requestInfo","unregisteredLocalisationCodes","jp","require","objectOfExternalAPI","query","externalAPIArray","map","uri","item","path","queryParams","queryParam","jPath","responseMapping","requesttype","variable","val","localisationCodes","localisationModules","variableToModuleMap","responses","responsePromises","i","length","temp1","temp2","flag","j","temp3","headers","accept","resPromise","axios","post","RequestInfo","get","responseType","push","Promise","all","res","data","replaceValue","value","loc","localisation","type","imageData","len","split","response","Buffer","from","toString","logger","error","stack","message","myDate","Date","isNaN","format","arrayOfOwnerObject","scema","l","ownerObject","k","fieldValue","required","prefix","isCategoryRequired","isMainTypeRequired","isSubTypeRequired","delimiter","includes","module","currentValue","isUpperCaseRequired","toUpperCase","localisationMap","resposnseMap","messages","code","Errors","Object","keys","forEach","index","indexOf","splice","objectKey","objectItemkey"],"mappings":"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","file":"externalAPIMapping.js","sourcesContent":["import get from \"lodash/get\";\nimport axios from \"axios\";\nimport {\n  getLocalisationkey,\n  findLocalisation,\n  getDateInRequiredFormat,\n  getValue\n} from \"./commons\";\nimport logger from \"../config/logger\";\n/**\n *\n * @param {*} key -name of the key used to identify module configs. Provided request URL\n * @param {*} req -current module object, picked from request body\n * @param {*} dataconfig - data config\n * @param {*} variableTovalueMap -map used for filling values by template engine 'mustache'\n * @param {*} localisationMap -Map to store localisation key, value pair\n * @param {*} requestInfo -request info from request body\n */\n\nfunction escapeRegex(string) {\n  if (typeof string == \"string\")\n    return string.replace(/[\\\\\"]/g, '\\\\$&');\n  else\n    return string;\n}\n\nexport const externalAPIMapping = async function (\n  key,\n  req,\n  dataconfig,\n  variableTovalueMap,\n  requestInfo,\n  unregisteredLocalisationCodes\n) {\n  var jp = require(\"jsonpath\");\n  var objectOfExternalAPI = getValue(\n    jp.query(dataconfig, \"$.DataConfigs.mappings.*.mappings.*.externalAPI.*\"),\n    [],\n    \"$.DataConfigs.mappings.*.mappings.*.externalAPI.*\"\n  );\n  var externalAPIArray = objectOfExternalAPI.map(item => {\n    return {\n      uri: item.path,\n      queryParams: item.queryParam,\n      jPath: item.responseMapping,\n      requesttype: item.requesttype || \"POST\",\n      variable: \"\",\n      val: \"\"\n    };\n  });\n\n  var localisationCodes = [];\n  var localisationModules = [];\n  var variableToModuleMap = {};\n\n  var responses = [];\n  var responsePromises = [];\n\n  for (let i = 0; i < externalAPIArray.length; i++) {\n    var temp1 = \"\";\n    var temp2 = \"\";\n    var flag = 0;\n    //to convert queryparam and uri into properURI\n\n    //for PT module\n    if (key == \"pt-receipt\") {\n      for (let j = 0; j < externalAPIArray[i].queryParams.length; j++) {\n        if (externalAPIArray[i].queryParams[j] == \"$\") {\n          flag = 1;\n        }\n        if (\n          externalAPIArray[i].queryParams[j] == \",\" ||\n          externalAPIArray[i].queryParams[j] == \":\"\n        ) {\n          if (flag == 1) {\n            temp2 = temp1;\n            var temp3 = getValue(jp.query(req, temp1), \"NA\", temp1);\n            externalAPIArray[i].queryParams = externalAPIArray[\n              i\n            ].queryParams.replace(temp2, temp3);\n\n            j = 0;\n            flag = 0;\n            temp1 = \"\";\n            temp2 = \"\";\n          }\n        }\n\n        if (flag == 1) {\n          temp1 += externalAPIArray[i].queryParams[j];\n        }\n        if (j == externalAPIArray[i].queryParams.length - 1 && flag == 1) {\n          temp2 = temp1;\n          var temp3 = getValue(jp.query(req, temp1), \"NA\", temp1);\n\n          externalAPIArray[i].queryParams = externalAPIArray[\n            i\n          ].queryParams.replace(temp2, temp3);\n\n          flag = 0;\n          temp1 = \"\";\n          temp2 = \"\";\n        }\n      }\n    }\n    //for other modules\n    else {\n      for (let j = 0; j < externalAPIArray[i].queryParams.length; j++) {\n        if (externalAPIArray[i].queryParams[j] == \"{\") {\n          externalAPIArray[i].queryParams = externalAPIArray[\n            i\n          ].queryParams.replace(\"{\", \"\");\n        }\n\n\n        if (externalAPIArray[i].queryParams[j] == \"$\") {\n          flag = 1;\n        }\n        if (\n          externalAPIArray[i].queryParams[j] == \",\" ||\n          externalAPIArray[i].queryParams[j] == \"}\"\n        ) {\n          if (flag == 1) {\n            temp2 = temp1;\n\n            var temp3 = getValue(jp.query(req, temp1), \"NA\", temp1);\n            externalAPIArray[i].queryParams = externalAPIArray[\n              i\n            ].queryParams.replace(temp2, temp3);\n\n            j = 0;\n            flag = 0;\n            temp1 = \"\";\n            temp2 = \"\";\n          }\n          if (externalAPIArray[i].queryParams[j] == \"}\") {\n            externalAPIArray[i].queryParams = externalAPIArray[\n              i\n            ].queryParams.replace(\"}\", \"\");\n          }\n\n        }\n        if (flag == 1) {\n          temp1 += externalAPIArray[i].queryParams[j];\n        }\n        if (j == externalAPIArray[i].queryParams.length - 1 && flag == 1) {\n          temp2 = temp1;\n          var temp3 = getValue(jp.query(req, temp1), \"NA\", temp1);\n\n          externalAPIArray[i].queryParams = externalAPIArray[\n            i\n          ].queryParams.replace(temp2, temp3);\n\n          flag = 0;\n          temp1 = \"\";\n          temp2 = \"\";\n        }\n      }\n    }\n    externalAPIArray[i].queryParams = externalAPIArray[i].queryParams.replace(\n      /,/g,\n      \"&\"\n    );\n    let headers = {\n      \"content-type\": \"application/json;charset=UTF-8\",\n      accept: \"application/json, text/plain, */*\"\n    };\n\n    var resPromise;\n    if (externalAPIArray[i].requesttype == \"POST\") {\n      resPromise = axios.post(\n        externalAPIArray[i].uri + \"?\" + externalAPIArray[i].queryParams, {\n          RequestInfo: requestInfo\n        }, {\n          headers: headers\n        }\n      );\n    } else {\n      resPromise = axios.get(\n        externalAPIArray[i].uri + \"?\" + externalAPIArray[i].queryParams, {\n          responseType: \"application/json\"\n        }\n      );\n    }\n    responsePromises.push(resPromise)\n  }\n\n  responses = await Promise.all(responsePromises)\n  for (let i = 0; i < externalAPIArray.length; i++) {\n    var res = responses[i].data\n\n    //putting required data from external API call in format config\n\n    for (let j = 0; j < externalAPIArray[i].jPath.length; j++) {\n      let replaceValue = getValue(\n        jp.query(res, externalAPIArray[i].jPath[j].value),\n        \"NA\",\n        externalAPIArray[i].jPath[j].value\n      );\n      let loc = externalAPIArray[i].jPath[j].localisation;\n      if (externalAPIArray[i].jPath[j].type == \"image\") {\n        // default empty image\n        var imageData =\n          \"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8Xw8AAoMBgDTD2qgAAAAASUVORK5CYII=\";\n        if (replaceValue != \"NA\") {\n          try {\n            var len = replaceValue[0].split(\",\").length;\n            var response = await axios.get(\n              replaceValue[0].split(\",\")[len - 1], {\n                responseType: \"arraybuffer\"\n              }\n            );\n            imageData =\n              \"data:\" +\n              response.headers[\"content-type\"] +\n              \";base64,\" +\n              Buffer.from(response.data).toString(\"base64\");\n          } catch (error) {\n            logger.error(error.stack || error);\n            throw {\n              message: `error while loading image from: ${replaceValue[0]}`\n            };\n          }\n        }\n        variableTovalueMap[externalAPIArray[i].jPath[j].variable] = imageData;\n      } else if (externalAPIArray[i].jPath[j].type == \"date\") {\n        let myDate = new Date(replaceValue[0]);\n        if (isNaN(myDate) || replaceValue[0] === 0) {\n          variableTovalueMap[externalAPIArray[i].jPath[j].variable] = \"NA\";\n        } else {\n          replaceValue = getDateInRequiredFormat(replaceValue[0], externalAPIArray[i].jPath[j].format);\n          variableTovalueMap[\n            externalAPIArray[i].jPath[j].variable\n          ] = replaceValue;\n        }\n      } else if (externalAPIArray[i].jPath[j].type == \"array\") {\n\n        let arrayOfOwnerObject = [];\n        // let ownerObject = JSON.parse(JSON.stringify(get(formatconfig, directArr[i].jPath + \"[0]\", [])));\n        let {\n          format = {}, value = [], variable\n        } = externalAPIArray[i].jPath[j];\n        let {\n          scema = []\n        } = format;\n        let val = getValue(jp.query(res, value), \"NA\", value);\n\n\n        //taking values about owner from request body\n        for (let l = 0; l < val.length; l++) {\n          // var x = 1;\n          let ownerObject = {};\n          for (let k = 0; k < scema.length; k++) {\n            let fieldValue = get(val[l], scema[k].value, \"NA\");\n            fieldValue = fieldValue == null ? \"NA\" : fieldValue;\n            if (scema[k].type == \"date\") {\n              let myDate = new Date(fieldValue);\n              if (isNaN(myDate) || fieldValue === 0) {\n                ownerObject[scema[k].variable] = \"NA\";\n              } else {\n                let replaceValue = getDateInRequiredFormat(fieldValue, scema[k].format);\n                // set(formatconfig,externalAPIArray[i].jPath[j].variable,replaceValue);\n                ownerObject[scema[k].variable] = replaceValue;\n              }\n            } else {\n              if (\n                fieldValue !== \"NA\" &&\n                scema[k].localisation &&\n                scema[k].localisation.required\n              ) {\n                let loc = scema[k].localisation;\n              fieldValue = await getLocalisationkey(\n                loc.prefix,\n                fieldValue,\n                loc.isCategoryRequired,\n                loc.isMainTypeRequired,\n                loc.isSubTypeRequired,\n                loc.delimiter\n              );\n              if(!localisationCodes.includes(fieldValue))\n                localisationCodes.push(fieldValue);\n\n              if(!localisationModules.includes(loc.module))\n                localisationModules.push(loc.module);\n\n              variableToModuleMap[scema[k].variable] = loc.module;\n              }\n              //console.log(\"\\nvalue-->\"+fieldValue)\n              let currentValue = fieldValue;\n              if (typeof currentValue == \"object\" && currentValue.length > 0)\n                currentValue = currentValue[0];\n\n              currentValue = escapeRegex(currentValue);\n              ownerObject[scema[k].variable] = currentValue;\n\n            }\n            // set(ownerObject[x], \"text\", get(val[j], scema[k].key, \"\"));\n            // x += 2;\n          }\n          arrayOfOwnerObject.push(ownerObject);\n\n        }\n\n        variableTovalueMap[variable] = arrayOfOwnerObject;\n        //console.log(\"\\nvariableTovalueMap[externalAPIArray[i].jPath.variable]--->\\n\"+JSON.stringify(variableTovalueMap[externalAPIArray[i].jPath.variable]));\n\n      } else {\n        if (\n          replaceValue !== \"NA\" &&\n          externalAPIArray[i].jPath[j].localisation &&\n          externalAPIArray[i].jPath[j].localisation.required &&\n          externalAPIArray[i].jPath[j].localisation.prefix\n        ){\n          let currentValue= await getLocalisationkey(\n            loc.prefix,\n            replaceValue,\n            loc.isCategoryRequired,\n            loc.isMainTypeRequired,\n            loc.isSubTypeRequired,\n            loc.delimiter\n          );\n          if (typeof currentValue == \"object\" && currentValue.length > 0)\n            currentValue = currentValue[0];\n\n          //currentValue = escapeRegex(currentValue);\n          if(!localisationCodes.includes(currentValue))\n            localisationCodes.push(currentValue);\n\n          if(!localisationModules.includes(loc.module))\n            localisationModules.push(loc.module);\n\n          variableTovalueMap[\n            externalAPIArray[i].jPath[j].variable\n          ] = currentValue;\n\n          variableToModuleMap[\n            externalAPIArray[i].jPath[j].variable\n          ] = loc.module;\n\n        }\n        else {\n          let currentValue = replaceValue;\n          if (typeof currentValue == \"object\" && currentValue.length > 0)\n            currentValue = currentValue[0];\n\n          // currentValue=currentValue.replace(/\\\\/g,\"\\\\\\\\\").replace(/\"/g,'\\\\\"');\n          currentValue = escapeRegex(currentValue);\n          variableTovalueMap[\n            externalAPIArray[i].jPath[j].variable\n          ] = currentValue;\n\n        }\n        if (externalAPIArray[i].jPath[j].isUpperCaseRequired) {\n          let currentValue =\n            variableTovalueMap[externalAPIArray[i].jPath[j].variable];\n          if (typeof currentValue == \"object\" && currentValue.length > 0)\n            currentValue = currentValue[0];\n\n          variableTovalueMap[\n            externalAPIArray[i].jPath[j].variable\n          ] = currentValue.toUpperCase();\n        }\n      }\n    }\n  }\n\n  let localisationMap = [];\n  try{\n    let resposnseMap = await findLocalisation(\n      requestInfo,\n      localisationModules,\n      localisationCodes\n    );\n  \n    resposnseMap.messages.map((item) => {\n      localisationMap[item.code + \"_\" + item.module] = item.message;\n    });\n  }\n  catch (error) {\n    logger.error(error.stack || error);\n    throw{\n      message: `Error in localisation service call: ${error.Errors[0].message}`\n    }; \n  }\n\n  Object.keys(variableTovalueMap).forEach(function(key) {\n    if(variableToModuleMap[key] && typeof variableTovalueMap[key] == 'string'){\n      var code = variableTovalueMap[key];\n      var module = variableToModuleMap[key];\n      if(localisationMap[code+\"_\"+module]){\n        variableTovalueMap[key] = localisationMap[code+\"_\"+module];\n        if(unregisteredLocalisationCodes.includes(code)){\n          var index = unregisteredLocalisationCodes.indexOf(code);\n          unregisteredLocalisationCodes.splice(index, 1);\n        }\n      }\n      else{\n        if(!unregisteredLocalisationCodes.includes(code))\n          unregisteredLocalisationCodes.push(code);\n      }\n    }\n\n    if(typeof variableTovalueMap[key] =='object'){\n      Object.keys(variableTovalueMap[key]).forEach(function(objectKey){\n        Object.keys(variableTovalueMap[key][objectKey]).forEach(function(objectItemkey) {\n          if(variableToModuleMap[objectItemkey]){\n            var module = variableToModuleMap[objectItemkey];\n            var code = variableTovalueMap[key][objectKey][objectItemkey];\n            if(localisationMap[code+\"_\"+module]){\n              variableTovalueMap[key][objectKey][objectItemkey] = localisationMap[code+\"_\"+module];\n              if(unregisteredLocalisationCodes.includes(code)){\n                var index = unregisteredLocalisationCodes.indexOf(code);\n                unregisteredLocalisationCodes.splice(index, 1);\n              }\n            }\n            else{\n              if(!unregisteredLocalisationCodes.includes(code))\n                unregisteredLocalisationCodes.push(code);\n            }\n          }\n        });\n      });    \n    }\n\n  });\n\n};"]}